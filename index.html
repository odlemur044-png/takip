<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>GÃ¼nlÃ¼k Takip ProgramÄ±</title>
<!-- â­ EN Ä°YÄ° SÃœRÃœM (STABLE) â€“ Bu sÃ¼rÃ¼m referans alÄ±narak geliÅŸtirilecektir -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#e8f5e9,#f4f6f8);
  padding:20px;
}
    h1 {
  text-align:center;
  margin-bottom:18px;
  letter-spacing:0.5px;
}
    .container {
  max-width:900px;
  margin:auto;
  background:#ffffff;
  padding:18px;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,0.08);
}
    input, button {
  padding:10px;
  font-size:1rem;
  border-radius:10px;
  border:1px solid #ddd;
}

button {
  background:#f5f5f5;
  cursor:pointer;
  transition:background 0.2s, transform 0.15s, box-shadow 0.15s;
}

button:hover {
  background:#e0e0e0;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
}

button:active {
  transform:scale(0.97);
}

    .task-grid { display:grid; grid-template-columns:repeat(5,1fr); gap:10px; margin-top:15px; }
    .task-card {
  border:1px solid #ddd;
  border-radius:12px;
  padding:8px;
  min-height:unset;
  height:auto;
  display:flex;
  align-items:flex-start;
  word-break:break-word;
  line-height:1.35;
  background:#fafafa;
  transition:background 0.25s, border-color 0.25s, box-shadow 0.2s, transform 0.15s;
  user-select:none;
  -webkit-user-select:none;
  -ms-user-select:none;
}
}

.task-card:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 14px rgba(0,0,0,0.08);
}

.task-card.completed {
  background:linear-gradient(135deg,#e8f5e9,#c8e6c9);
  border-color:#66bb6a;
}

.task-card.delete-hold{
  background:#ffebee !important;
  border-color:#e53935 !important;
  color:#b71c1c;
}
    .task-card.completed { background:#e8f5e9; border-color:#66bb6a; }
    .done { text-decoration:line-through; color:gray; }

    #monthDays {
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
  margin-top:10px;
}
#monthDays button{
  position:relative;
  border:1px solid #ddd;
  border-radius:10px;
  background:#fafafa;
  padding:8px 0 6px;
  font-size:0.85rem;
  min-height:36px;
  transition:transform .15s, box-shadow .15s, background .2s;
}
#monthDays button:hover{
  transform:translateY(-2px);
  box-shadow:0 4px 10px rgba(0,0,0,.08);
}
#monthDays button.active{
  background:#c8e6c9;
  border-color:#66bb6a;
}
#monthDays button.today{
  outline:2px solid #4caf50;
}
    #monthDays button { border:1px solid #ccc; border-radius:6px; background:#f8f9fa; padding:6px 0; font-size:0.8rem; min-height:32px; }
    #monthDays button.active { background:#c8e6c9; }

    .day-dot{ width:6px; height:6px; border-radius:50%; margin:2px auto 0; background:#fff; border:1px solid #ccc; }
    .dot-has{ background:#ffd54f; border-color:#fbc02d; }
    .dot-done{ background:#81c784; border-color:#4caf50; }

    #dayList { display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:8px; margin-top:10px; }

    .delete-hold { background:#ffdddd !important; border-color:#ff5c5c !important; color:#a40000; }
  </style>
</head>
<body>

<h1>ðŸ“‹ GÃ¼nlÃ¼k Takip ProgramÄ± <small style="font-size:0.8rem;color:#4caf50;">(En Ä°yi SÃ¼rÃ¼m)</small></h1>
<div class="container">

  <label><strong>Ay / YÄ±l SeÃ§:</strong></label>
  <input type="month" id="monthInput">
  <button id="toggleMulti" style="margin-top:6px;">âž• Birden Fazla GÃ¼n SeÃ§</button>
  <button id="clearSelected" style="margin-top:6px;background:#ffdddd;border:1px solid #ff5c5c;">ðŸ§¹ SeÃ§ilen GÃ¼nleri Temizle</button>
  <div id="monthDays"></div>

  <hr>

  <label><strong>Yeni Ä°ÅŸ <small style="font-weight:normal;color:#666;font-size:0.85rem;">(silmek iÃ§in basÄ±lÄ± tut)</small>:</strong></label>
  <input type="text" id="taskInput" placeholder="YapÄ±lacak iÅŸi yaz">
  <button id="addBtn">âž• Ä°ÅŸ Ekle</button>

  <div id="taskGrid" class="task-grid"></div>

  <hr>
  <details style="margin-top:15px;">
    <summary style="cursor:pointer;font-weight:bold;">ðŸ’¾ Yedekleme</summary>
    <div style="margin-top:10px;">
      <button id="backupBtn">ðŸ“¤ Yedek Al</button><br><br>
      <input type="file" id="restoreInput" accept="application/json"><br><br>
      <button id="restoreBtn">ðŸ“¥ Geri YÃ¼kle</button>
    </div>
  </details>
</div>

<script>
document.addEventListener('DOMContentLoaded',()=>{
let currentDate = null;
let selectedDays = [];
let multiSelect = false;

const monthInput = document.getElementById('monthInput');
const monthDays  = document.getElementById('monthDays');
const taskGrid   = document.getElementById('taskGrid');
const taskInput  = document.getElementById('taskInput');
const dayList    = document.getElementById('dayList');
const addBtn     = document.getElementById('addBtn');
const backupBtn  = document.getElementById('backupBtn');
const restoreBtn = document.getElementById('restoreBtn');
const restoreInput = document.getElementById('restoreInput');
const clearSelectedBtn = document.getElementById('clearSelected');

function getDays(){ return JSON.parse(localStorage.getItem('days')) || {}; }
function saveDays(d){ localStorage.setItem('days', JSON.stringify(d)); }

monthInput.addEventListener('change', () => {
  monthDays.innerHTML = '';
  selectedDays = [];
  currentDate = null;

  if(!monthInput.value) return;
  const [y,m] = monthInput.value.split('-').map(Number);
  const count = new Date(y,m,0).getDate();

  for(let d=1; d<=count; d++){
    const iso = `${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const btn = document.createElement('button');
    btn.type='button';
    btn.textContent=d;
    btn.dataset.date=iso;

    const dot=document.createElement('div');
    dot.className='day-dot';

    const daysData=getDays();
    if(daysData[iso] && daysData[iso].length>0){
      const allDone = daysData[iso].every(t=>t.done);
      dot.classList.add(allDone?'dot-done':'dot-has');
    }

    // TIKLAMA = seÃ§
    btn.onclick = () => {
      if(btn._longPressed){ btn._longPressed=false; return; }
      const days=getDays();
      if(!days[iso]) days[iso]=[];

      if(!multiSelect){
        [...monthDays.children].forEach(b=>b.classList.remove('active'));
        selectedDays=[iso];
        btn.classList.add('active');
      }else{
        if(selectedDays.includes(iso)){
          selectedDays=selectedDays.filter(x=>x!==iso);
          btn.classList.remove('active');
        }else{
          selectedDays.push(iso);
          btn.classList.add('active');
        }
      }
      currentDate=iso;
      saveDays(days);
      loadDay();
      
    };

    // BASILI TUTMA = gÃ¼nÃ¼ temizle
    let holdTimer=null;
    const holdStart=()=>{
      btn._longPressed=false;
      btn.classList.add('delete-hold');
      holdTimer=setTimeout(()=>{
        btn._longPressed=true;
        btn.classList.remove('delete-hold');
        const days=getDays();
        if(days[iso]){
          if(confirm(iso+' gÃ¼nÃ¼ndeki tÃ¼m gÃ¶revler silinsin mi?')){
            delete days[iso];
            saveDays(days);
            if(currentDate===iso) currentDate=null;
            loadDay();
            
            renderMonthDots();
          }
        }
      },700);
    };
    const holdCancel=()=>{
      if(holdTimer) clearTimeout(holdTimer);
      btn.classList.remove('delete-hold');
    };

    btn.addEventListener('mousedown',holdStart);
    btn.addEventListener('mouseup',holdCancel);
    btn.addEventListener('mouseleave',holdCancel);
    btn.addEventListener('touchstart',holdStart);
    btn.addEventListener('touchend',holdCancel);
    btn.addEventListener('touchcancel',holdCancel);

    btn.appendChild(dot);
    monthDays.appendChild(btn);
  }
});

// Ã‡oklu seÃ§im aÃ§/kapat
document.getElementById('toggleMulti').onclick=()=>{
  multiSelect=!multiSelect;
  document.getElementById('toggleMulti').textContent = multiSelect ? 'âœ” Ã‡oklu SeÃ§im AÃ§Ä±k' : 'âž• Birden Fazla GÃ¼n SeÃ§';
  if(!multiSelect && selectedDays.length>1) selectedDays=[selectedDays[0]];
};

// SeÃ§ilen gÃ¼nleri toplu temizle
clearSelectedBtn.onclick = () => {
  if(selectedDays.length===0) return alert('Temizlemek iÃ§in gÃ¼n seÃ§');
  if(!confirm(selectedDays.join(', ')+' gÃ¼nlerindeki TÃœM gÃ¶revler silinsin mi?')) return;
  const days = getDays();
  selectedDays.forEach(d=>{ delete days[d]; });
  saveDays(days);
  selectedDays = [];
  currentDate = null;
  loadDay();
  renderMonthDots();
  [...monthDays.children].forEach(b=>b.classList.remove('active'));
};

function loadDay(){
  taskGrid.innerHTML='';
  if(!currentDate) return;
  const days=getDays();
  const tasks=days[currentDate]||[];

  const maxSlots = Math.max( tasks.length + 2, 5 );
  for(let i=0;i<maxSlots;i++){
    const card=document.createElement('div');
    card.className='task-card';

    if(tasks[i]){
      card.textContent = tasks[i].text;
      // yazÄ± uzunluÄŸuna gÃ¶re padding / gÃ¶rÃ¼nÃ¼m ayarÄ±
      const len = tasks[i].text.length;
      if(len < 20) card.style.padding = '6px';
      else if(len < 60) card.style.padding = '8px';
      else card.style.padding = '10px';
      if(tasks[i].done) card.classList.add('done','completed');

      let timer=null, long=false;
      card.onclick=()=>{
        card.oncontextmenu = e => e.preventDefault();
        if(long){ long=false; return; }
        tasks[i].done=!tasks[i].done;
        saveDays(days);
        loadDay();
        renderMonthDots();
      };

      const start=()=>{
        long=false;
        card.classList.add('delete-hold');
        timer=setTimeout(()=>{
          long=true;
          card.classList.remove('delete-hold');
          if(confirm('Bu gÃ¶revi silmek istiyor musun?')){
            tasks.splice(i,1);
            saveDays(days);
            loadDay();
            
            renderMonthDots();
          }
        },700);
      };
      const cancel=()=>{ if(timer) clearTimeout(timer); card.classList.remove('delete-hold'); };

      card.addEventListener('mousedown',start);
      card.addEventListener('mouseup',cancel);
      card.addEventListener('mouseleave',cancel);
      card.addEventListener('touchstart',start);
      card.addEventListener('touchend',cancel);
      card.addEventListener('touchcancel',cancel);

    }else{
      card.style.opacity='0.3';
      card.textContent='BoÅŸ';
    }
    taskGrid.appendChild(card);
  }
}

function renderMonthDots(){
  [...monthDays.children].forEach(btn=>{
    const iso=btn.dataset.date;
    const dot=btn.querySelector('.day-dot');
    dot.className='day-dot';
    const days=getDays();
    if(days[iso] && days[iso].length>0){
      dot.classList.add(days[iso].every(t=>t.done)?'dot-done':'dot-has');
    }
  });
}

addBtn.onclick=()=>{
  if(selectedDays.length===0) return alert('Ã–nce gÃ¼n seÃ§');
  if(!taskInput.value.trim()) return;
  const days=getDays();
  selectedDays.forEach(d=>{ if(!days[d]) days[d]=[]; days[d].push({text:taskInput.value,done:false}); });
  saveDays(days);
  taskInput.value='';
  loadDay();
  
  renderMonthDots();
};

function loadDaysList(){
  // KayÄ±tlÄ± gÃ¼nler sekmesi kaldÄ±rÄ±ldÄ± â€“ veri ve diÄŸer iÅŸlevler korunuyor
}

backupBtn.onclick=()=>{
  const blob=new Blob([JSON.stringify({days:getDays()},null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='gunluk-takip-yedek.json'; a.click();
};

restoreBtn.onclick=()=>{
  const f=restoreInput.files[0]; if(!f) return alert('Dosya seÃ§');
  const r=new FileReader();
  r.onload=e=>{ try{ const d=JSON.parse(e.target.result); localStorage.setItem('days',JSON.stringify(d.days));  loadDay(); renderMonthDots(); alert('Yedek yÃ¼klendi'); }catch{ alert('GeÃ§ersiz dosya'); } };
  r.readAsText(f);
};


  // Ä°lk aÃ§Ä±lÄ±ÅŸta mevcut ay/yÄ±l otomatik seÃ§ilsin
  const now = new Date();
  const y = now.getFullYear();
  const m = String(now.getMonth()+1).padStart(2,'0');
  monthInput.value = `${y}-${m}`;
  monthInput.dispatchEvent(new Event('change'));

});
</script>
</body>
</html>
